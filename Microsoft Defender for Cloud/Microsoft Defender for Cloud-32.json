{"recommendations":[{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3/providers/Microsoft.Security/assessments/22e93e92-4a31-b4cd-d640-3ef908430aa6","name":"22e93e92-4a31-b4cd-d640-3ef908430aa6","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"Microsoft.Sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-viram-3","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3"},"displayName":"Public network access on Azure SQL Database should be disabled","status":{"firstEvaluationDate":"2024-01-09T12:38:51.9978237Z","statusChangeDate":"2024-01-09T12:38:51.9978237Z","code":"Unhealthy"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-01-09T12:38:51.9978237Z","statusChangeDate":"2024-01-09T12:38:51.9978237Z","code":"Unhealthy"}}],"metadata":{"description":"Disabling the public network access property improves security by ensuring your Azure SQL Database can only be accessed from a private endpoint. This configuration denies all logins that match IP or virtual network based firewall rules.","severity":"Medium","displayName":"Public network access on Azure SQL Database should be disabled","assessmentType":"BuiltIn","remediationDescription":"To disable Public Network Access: 1. Open Azure SQL Database and browse to the server blade 2. Navigate to Security --> Firewalls and virtual networks blade via the navigation menu on the left. 3. Select Deny Public Network Access control and change the value to Yes.","policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/1b8ca024-1d5c-4dec-8995-b1a932b41780","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"securityIssue":"NetworkHasPublicIp","categories":["Data"],"techniques":["Exploit Public-Facing Application"],"tactics":["Initial Access"],"preview":true},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/22e93e92-4a31-b4cd-d640-3ef908430aa6/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2fresource-graph-queries%2fproviders%2fMicrosoft.Sql%2fservers%2ftest-viram-3"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3","status":"Unhealthy","cause":"","assessmentKey":"22e93e92-4a31-b4cd-d640-3ef908430aa6"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3/providers/Microsoft.Security/assessments/75396512-3323-9be4-059d-32ecb113c3de","name":"75396512-3323-9be4-059d-32ecb113c3de","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"Microsoft.Sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-viram-3","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3"},"displayName":"Private endpoint connections on Azure SQL Database should be enabled","status":{"firstEvaluationDate":"2024-01-09T12:38:51.9911566Z","statusChangeDate":"2024-01-09T12:38:51.9911566Z","code":"Unhealthy"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-01-09T12:38:51.9911566Z","statusChangeDate":"2024-01-09T12:38:51.9911566Z","code":"Unhealthy"}}],"metadata":{"description":"Private endpoint connections enforce secure communication by enabling private connectivity to Azure SQL Database.","severity":"Medium","displayName":"Private endpoint connections on Azure SQL Database should be enabled","assessmentType":"BuiltIn","remediationDescription":"To enable Private Endpoint Connections: 1. Open Azure SQL Database and browse to the server blade 2. Navigate to Security --> Private endpoint connections blade via the navigation menu 3.  Select the \"+ Private Endpoint\" button 4. Follow the instructions here: https://docs.microsoft.com/azure/azure-sql/database/private-endpoint-overview#how-to-set-up-private-link-for-azure-sql-database.","policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/7698e800-9299-47a6-b3b6-5a0fee576eed","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"securityIssue":"NetworkPrivateNetwork","categories":["Data"],"techniques":["Network Sniffing","Network Denial of Service","Endpoint Denial of Service","Man-in-the-Middle","Data Manipulation","External Remote Services"],"tactics":["Discovery","Impact","Collection","Initial Access"],"preview":true},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/75396512-3323-9be4-059d-32ecb113c3de/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2fresource-graph-queries%2fproviders%2fMicrosoft.Sql%2fservers%2ftest-viram-3"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3","status":"Unhealthy","cause":"","assessmentKey":"75396512-3323-9be4-059d-32ecb113c3de"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37","name":"82e20e14-edc5-4373-bfc4-f13121257c37","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"microsoft.sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-viram-3","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3"},"displayName":"SQL databases should have vulnerability findings resolved","additionalData":{"subAssessmentsLink":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37/subAssessments"},"status":{"firstEvaluationDate":"2024-01-15T23:02:15.981658Z","statusChangeDate":"2024-01-25T07:43:56.2856789Z","code":"Unhealthy","cause":"Unknown"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-01-15T23:02:15.981658Z","statusChangeDate":"2024-01-25T07:43:56.2856789Z","code":"Unhealthy","cause":"Unknown"}}],"metadata":{"description":"The SQL Vulnerability Assessment scanner identifies security vulnerabilities in databases. These vulnerabilitiess include misconfigurations, excessive permissions, and unprotected sensitive data.<br> If these vulnerabilities are not addressed, they could potentially be exploited, leading to unauthorized access or data breaches.<br>","severity":"High","displayName":"SQL databases should have vulnerability findings resolved","assessmentType":"BuiltIn","remediationDescription":"To remediate SQL vulnerabilities and mitigate risks:<br>1. Navigate to a database in the Unhealthy databases list.<br>2. Review the set of Failed security checks found by the scan, which are sorted from high to low risk.<br>3. Select a vulnerability to view its details and explicit remediation instructions and scripts<br>4. Either remediate the vulnerability using the provided script, or set the result as an acceptable baseline for the check so that it will be considered passing in subsequent scans.","policyDefinitionId":"/providers/microsoft.authorization/policydefinitions/feedbf84-6b99-488c-acc2-71c829aa5ffc","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"implementationEffort":"Moderate","securityIssue":"Vulnerability","categories":["Data"],"userImpact":"Low","techniques":["Exploit Public-Facing Application","Exploitation for Privilege Escalation","Valid Accounts","Modify Registry","Server Software Component"],"threats":["DataExfiltration","DataSpillage","AccountBreach"],"tactics":["Initial Access","Privilege Escalation","Persistence","Defense Evasion"]},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/82e20e14-edc5-4373-bfc4-f13121257c37/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2fresource-graph-queries%2fproviders%2fmicrosoft.sql%2fservers%2ftest-viram-3"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3","status":"Unhealthy","cause":"Unknown","assessmentKey":"82e20e14-edc5-4373-bfc4-f13121257c37"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3/providers/Microsoft.Security/assessments/94208a8b-16e8-4e5b-abbd-4e81c9d02bee","name":"94208a8b-16e8-4e5b-abbd-4e81c9d02bee","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"Microsoft.Sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-viram-3","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3"},"displayName":"Auditing on SQL server should be enabled","status":{"firstEvaluationDate":"2024-01-09T12:38:51.7085836Z","statusChangeDate":"2024-01-09T12:38:51.7085836Z","code":"Unhealthy"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-01-09T12:38:51.7085836Z","statusChangeDate":"2024-01-09T12:38:51.7085836Z","code":"Unhealthy"}}],"metadata":{"description":"Enable auditing on your SQL Server to track database activities across all databases on the server and save them in an audit log.","severity":"Low","displayName":"Auditing on SQL server should be enabled","assessmentType":"BuiltIn","remediationDescription":"To enable SQL server auditing:<br>1. Go to 'SQL servers' page in the Azure portal and select your SQL server.<br>2. From the top left menu, select 'Auditing' and choose 'Enable Azure SQL Auditing'.<br>3. Select one of the options to store the Audit logs and follow the instructions.<br>4. Select 'Save'.","policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/a6fb4358-5bf4-4ad7-ba82-2cd2f41ce5e9","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"implementationEffort":"Low","securityIssue":"Auditing","categories":["Data"],"userImpact":"Low","threats":["DataExfiltration","DataSpillage","MaliciousInsider","ThreatResistance"],"remediationPolicy":"/providers/Microsoft.Authorization/policyDefinitions/f4c68484-132f-41f9-9b6d-3e4b1cb55036"},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/94208a8b-16e8-4e5b-abbd-4e81c9d02bee/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2fresource-graph-queries%2fproviders%2fMicrosoft.Sql%2fservers%2ftest-viram-3"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3","status":"Unhealthy","cause":"","assessmentKey":"94208a8b-16e8-4e5b-abbd-4e81c9d02bee"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3/providers/Microsoft.Security/assessments/c076bfee-3834-4685-8ab5-17f5207c827e","name":"c076bfee-3834-4685-8ab5-17f5207c827e","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"Microsoft.Sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-viram-3","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3"},"displayName":"Azure SQL Database should have Azure Active Directory Only Authentication enabled","status":{"firstEvaluationDate":"2024-01-09T12:38:52.0438105Z","statusChangeDate":"2024-01-09T12:38:52.0438105Z","code":"Unhealthy"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-01-09T12:38:52.0438105Z","statusChangeDate":"2024-01-09T12:38:52.0438105Z","code":"Unhealthy"}}],"metadata":{"description":"Disabling local authentication methods and allowing only Azure Active Directory Authentication improves security by ensuring that Azure SQL Databases can exclusively be accessed by Azure Active Directory identities. Learn more at: aka.ms/adonlycreate.","severity":"Medium","displayName":"Azure SQL Database should have Azure Active Directory Only Authentication enabled","assessmentType":"BuiltIn","remediationDescription":"To disable local authentication methods and only allow Azure Active Directory authentication: 1. Find your Azure Sql server in the portal. 2. Navigate to Azure Active Directory in the left navigation pane. 3. Select \"Set admin\" if Azure Active Directory admin is not already set. 4. Check the \"Support only Azure Active Directory authentication for this server\" box and press \"Save\". See https://learn.microsoft.com/en-us/azure/azure-sql/database/authentication-azure-ad-only-authentication-tutorial?WT.mc_id=Portal-Microsoft_Azure_Security for further details.","policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/abda6d70-9778-44e7-84a8-06713e6db027","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"securityIssue":"PermissionsUseIdp","categories":["Data"],"techniques":["Valid Accounts","Brute Force"],"tactics":["Initial Access"],"preview":true},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/c076bfee-3834-4685-8ab5-17f5207c827e/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2fresource-graph-queries%2fproviders%2fMicrosoft.Sql%2fservers%2ftest-viram-3"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3","status":"Unhealthy","cause":"","assessmentKey":"c076bfee-3834-4685-8ab5-17f5207c827e"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3/providers/Microsoft.Security/assessments/f0553104-cfdb-65e6-759c-002812e38500","name":"f0553104-cfdb-65e6-759c-002812e38500","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"Microsoft.Sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-viram-3","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram-3"},"displayName":"SQL servers should have an Azure Active Directory administrator provisioned","status":{"firstEvaluationDate":"2024-01-09T12:38:51.7230573Z","statusChangeDate":"2024-01-09T12:38:51.7230573Z","code":"Unhealthy"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-01-09T12:38:51.7230573Z","statusChangeDate":"2024-01-09T12:38:51.7230573Z","code":"Unhealthy"}}],"metadata":{"description":"Provision an Azure AD administrator for your SQL server to enable Azure AD authentication. Azure AD authentication enables simplified permission management and centralized identity management of database users and other Microsoft services.","severity":"High","displayName":"SQL servers should have an Azure Active Directory administrator provisioned","assessmentType":"BuiltIn","remediationDescription":"To provision an Azure AD administrator for SQL server, see <a target='blank' href='https://docs.microsoft.com/azure/sql-database/sql-database-aad-authentication-configure'>Configure and manage Azure Active Directory authentication with SQL Database, Managed Instance, or SQL Data Warehouse</a>","policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/1f314764-cb73-4fc9-b863-8eca98ac36e9","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"implementationEffort":"Moderate","securityIssue":"PermissionsUseIdp","categories":["Data"],"userImpact":"Moderate","techniques":["Valid Accounts","Brute Force"],"threats":["MaliciousInsider","AccountBreach"],"tactics":["Initial Access"]},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/f0553104-cfdb-65e6-759c-002812e38500/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2fresource-graph-queries%2fproviders%2fMicrosoft.Sql%2fservers%2ftest-viram-3"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3","status":"Unhealthy","cause":"","assessmentKey":"f0553104-cfdb-65e6-759c-002812e38500"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram/providers/Microsoft.Security/assessments/22e93e92-4a31-b4cd-d640-3ef908430aa6","name":"22e93e92-4a31-b4cd-d640-3ef908430aa6","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"Microsoft.Sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-viram","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram"},"displayName":"Public network access on Azure SQL Database should be disabled","status":{"firstEvaluationDate":"2024-01-09T09:10:56.4444192Z","statusChangeDate":"2024-01-09T09:10:56.4444192Z","code":"Unhealthy"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-01-09T09:10:56.4444192Z","statusChangeDate":"2024-01-09T09:10:56.4444192Z","code":"Unhealthy"}}],"metadata":{"description":"Disabling the public network access property improves security by ensuring your Azure SQL Database can only be accessed from a private endpoint. This configuration denies all logins that match IP or virtual network based firewall rules.","severity":"Medium","displayName":"Public network access on Azure SQL Database should be disabled","assessmentType":"BuiltIn","remediationDescription":"To disable Public Network Access: 1. Open Azure SQL Database and browse to the server blade 2. Navigate to Security --> Firewalls and virtual networks blade via the navigation menu on the left. 3. Select Deny Public Network Access control and change the value to Yes.","policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/1b8ca024-1d5c-4dec-8995-b1a932b41780","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"securityIssue":"NetworkHasPublicIp","categories":["Data"],"techniques":["Exploit Public-Facing Application"],"tactics":["Initial Access"],"preview":true},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/22e93e92-4a31-b4cd-d640-3ef908430aa6/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2fresource-graph-queries%2fproviders%2fMicrosoft.Sql%2fservers%2ftest-viram"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram","status":"Unhealthy","cause":"","assessmentKey":"22e93e92-4a31-b4cd-d640-3ef908430aa6"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram/providers/Microsoft.Security/assessments/75396512-3323-9be4-059d-32ecb113c3de","name":"75396512-3323-9be4-059d-32ecb113c3de","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"Microsoft.Sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-viram","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram"},"displayName":"Private endpoint connections on Azure SQL Database should be enabled","status":{"firstEvaluationDate":"2024-01-09T09:10:56.4366093Z","statusChangeDate":"2024-01-09T09:10:56.4366093Z","code":"Unhealthy"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-01-09T09:10:56.4366093Z","statusChangeDate":"2024-01-09T09:10:56.4366093Z","code":"Unhealthy"}}],"metadata":{"description":"Private endpoint connections enforce secure communication by enabling private connectivity to Azure SQL Database.","severity":"Medium","displayName":"Private endpoint connections on Azure SQL Database should be enabled","assessmentType":"BuiltIn","remediationDescription":"To enable Private Endpoint Connections: 1. Open Azure SQL Database and browse to the server blade 2. Navigate to Security --> Private endpoint connections blade via the navigation menu 3.  Select the \"+ Private Endpoint\" button 4. Follow the instructions here: https://docs.microsoft.com/azure/azure-sql/database/private-endpoint-overview#how-to-set-up-private-link-for-azure-sql-database.","policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/7698e800-9299-47a6-b3b6-5a0fee576eed","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"securityIssue":"NetworkPrivateNetwork","categories":["Data"],"techniques":["Network Sniffing","Network Denial of Service","Endpoint Denial of Service","Man-in-the-Middle","Data Manipulation","External Remote Services"],"tactics":["Discovery","Impact","Collection","Initial Access"],"preview":true},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/75396512-3323-9be4-059d-32ecb113c3de/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2fresource-graph-queries%2fproviders%2fMicrosoft.Sql%2fservers%2ftest-viram"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram","status":"Unhealthy","cause":"","assessmentKey":"75396512-3323-9be4-059d-32ecb113c3de"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37","name":"82e20e14-edc5-4373-bfc4-f13121257c37","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"microsoft.sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-viram","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram"},"displayName":"SQL databases should have vulnerability findings resolved","additionalData":{"subAssessmentsLink":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37/subAssessments"},"status":{"firstEvaluationDate":"2024-01-09T09:33:33.7803291Z","statusChangeDate":"2024-01-25T07:17:24.3706209Z","code":"Unhealthy","cause":"Unknown"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-01-09T09:33:33.7803291Z","statusChangeDate":"2024-01-25T07:17:24.3706209Z","code":"Unhealthy","cause":"Unknown"}}],"metadata":{"description":"The SQL Vulnerability Assessment scanner identifies security vulnerabilities in databases. These vulnerabilitiess include misconfigurations, excessive permissions, and unprotected sensitive data.<br> If these vulnerabilities are not addressed, they could potentially be exploited, leading to unauthorized access or data breaches.<br>","severity":"High","displayName":"SQL databases should have vulnerability findings resolved","assessmentType":"BuiltIn","remediationDescription":"To remediate SQL vulnerabilities and mitigate risks:<br>1. Navigate to a database in the Unhealthy databases list.<br>2. Review the set of Failed security checks found by the scan, which are sorted from high to low risk.<br>3. Select a vulnerability to view its details and explicit remediation instructions and scripts<br>4. Either remediate the vulnerability using the provided script, or set the result as an acceptable baseline for the check so that it will be considered passing in subsequent scans.","policyDefinitionId":"/providers/microsoft.authorization/policydefinitions/feedbf84-6b99-488c-acc2-71c829aa5ffc","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"implementationEffort":"Moderate","securityIssue":"Vulnerability","categories":["Data"],"userImpact":"Low","techniques":["Exploit Public-Facing Application","Exploitation for Privilege Escalation","Valid Accounts","Modify Registry","Server Software Component"],"threats":["DataExfiltration","DataSpillage","AccountBreach"],"tactics":["Initial Access","Privilege Escalation","Persistence","Defense Evasion"]},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/82e20e14-edc5-4373-bfc4-f13121257c37/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2fresource-graph-queries%2fproviders%2fmicrosoft.sql%2fservers%2ftest-viram"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram","status":"Unhealthy","cause":"Unknown","assessmentKey":"82e20e14-edc5-4373-bfc4-f13121257c37"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram/providers/Microsoft.Security/assessments/94208a8b-16e8-4e5b-abbd-4e81c9d02bee","name":"94208a8b-16e8-4e5b-abbd-4e81c9d02bee","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"Microsoft.Sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-viram","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram"},"displayName":"Auditing on SQL server should be enabled","status":{"firstEvaluationDate":"2024-01-09T09:10:56.0711541Z","statusChangeDate":"2024-01-25T07:38:13.1717149Z","code":"Unhealthy"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-01-09T09:10:56.0711541Z","statusChangeDate":"2024-01-25T07:38:13.1717149Z","code":"Unhealthy"}}],"metadata":{"description":"Enable auditing on your SQL Server to track database activities across all databases on the server and save them in an audit log.","severity":"Low","displayName":"Auditing on SQL server should be enabled","assessmentType":"BuiltIn","remediationDescription":"To enable SQL server auditing:<br>1. Go to 'SQL servers' page in the Azure portal and select your SQL server.<br>2. From the top left menu, select 'Auditing' and choose 'Enable Azure SQL Auditing'.<br>3. Select one of the options to store the Audit logs and follow the instructions.<br>4. Select 'Save'.","policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/a6fb4358-5bf4-4ad7-ba82-2cd2f41ce5e9","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"implementationEffort":"Low","securityIssue":"Auditing","categories":["Data"],"userImpact":"Low","threats":["DataExfiltration","DataSpillage","MaliciousInsider","ThreatResistance"],"remediationPolicy":"/providers/Microsoft.Authorization/policyDefinitions/f4c68484-132f-41f9-9b6d-3e4b1cb55036"},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/94208a8b-16e8-4e5b-abbd-4e81c9d02bee/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2fresource-graph-queries%2fproviders%2fMicrosoft.Sql%2fservers%2ftest-viram"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram","status":"Unhealthy","cause":"","assessmentKey":"94208a8b-16e8-4e5b-abbd-4e81c9d02bee"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram/providers/Microsoft.Security/assessments/c076bfee-3834-4685-8ab5-17f5207c827e","name":"c076bfee-3834-4685-8ab5-17f5207c827e","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"Microsoft.Sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-viram","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/Microsoft.Sql/servers/test-viram"},"displayName":"Azure SQL Database should have Azure Active Directory Only Authentication enabled","status":{"firstEvaluationDate":"2024-01-09T09:10:56.4825035Z","statusChangeDate":"2024-01-09T09:10:56.4825035Z","code":"Unhealthy"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-01-09T09:10:56.4825035Z","statusChangeDate":"2024-01-09T09:10:56.4825035Z","code":"Unhealthy"}}],"metadata":{"description":"Disabling local authentication methods and allowing only Azure Active Directory Authentication improves security by ensuring that Azure SQL Databases can exclusively be accessed by Azure Active Directory identities. Learn more at: aka.ms/adonlycreate.","severity":"Medium","displayName":"Azure SQL Database should have Azure Active Directory Only Authentication enabled","assessmentType":"BuiltIn","remediationDescription":"To disable local authentication methods and only allow Azure Active Directory authentication: 1. Find your Azure Sql server in the portal. 2. Navigate to Azure Active Directory in the left navigation pane. 3. Select \"Set admin\" if Azure Active Directory admin is not already set. 4. Check the \"Support only Azure Active Directory authentication for this server\" box and press \"Save\". See https://learn.microsoft.com/en-us/azure/azure-sql/database/authentication-azure-ad-only-authentication-tutorial?WT.mc_id=Portal-Microsoft_Azure_Security for further details.","policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/abda6d70-9778-44e7-84a8-06713e6db027","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"securityIssue":"PermissionsUseIdp","categories":["Data"],"techniques":["Valid Accounts","Brute Force"],"tactics":["Initial Access"],"preview":true},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/c076bfee-3834-4685-8ab5-17f5207c827e/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2fresource-graph-queries%2fproviders%2fMicrosoft.Sql%2fservers%2ftest-viram"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram","status":"Unhealthy","cause":"","assessmentKey":"c076bfee-3834-4685-8ab5-17f5207c827e"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.storage/storageaccounts/testviram/providers/Microsoft.Security/assessments/3b363842-30f5-4056-980d-3a40fa5de8b3","name":"3b363842-30f5-4056-980d-3a40fa5de8b3","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"microsoft.storage","ResourceType":"microsoft.storage/storageaccounts","ResourceName":"testviram","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.storage/storageaccounts/testviram","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.storage/storageaccounts/testviram","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.storage/storageaccounts/testviram"},"displayName":"Storage accounts should prevent shared key access","status":{"firstEvaluationDate":"2024-01-09T11:30:55.216674Z","statusChangeDate":"2024-01-09T11:30:55.216674Z","code":"Unhealthy"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-01-09T11:30:55.216674Z","statusChangeDate":"2024-01-09T11:30:55.216674Z","code":"Unhealthy"}}],"metadata":{"description":"Audit requirement of Azure Active Directory (Azure AD) to authorize requests for your storage account. By default, requests can be authorized with either Azure Active Directory credentials, or by using the account access key for Shared Key authorization. Of these two types of authorization, Azure AD provides superior security and ease of use over Shared Key, and is recommended by Microsoft.","severity":"Medium","displayName":"Storage accounts should prevent shared key access","assessmentType":"BuiltIn","remediationDescription":"To disable shared key access for your storage account: 1. Navigate to your storage account in Azure Portal. 2. Set Configuration -> Setting -> Allow shared key access to disabled. For more information, see the documentation https://docs.microsoft.com/azure/storage/common/shared-key-authorization-prevent?tabs=portal#remediate-authorization-via-shared-key.","policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/8c6a50c6-9ffd-4ae7-986f-5fa6111f9a54","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"securityIssue":"PermissionsUseIdp","categories":["Unknown"],"techniques":["Valid Accounts","Brute Force"],"tactics":["Initial Access"],"preview":true},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/3b363842-30f5-4056-980d-3a40fa5de8b3/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2fresource-graph-queries%2fproviders%2fmicrosoft.storage%2fstorageaccounts%2ftestviram"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.storage/storageaccounts/testviram","status":"Unhealthy","cause":"","assessmentKey":"3b363842-30f5-4056-980d-3a40fa5de8b3"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.storage/storageaccounts/testviram/providers/Microsoft.Security/assessments/cdc78c07-02b0-4af0-1cb2-cb7c672a8b0a","name":"cdc78c07-02b0-4af0-1cb2-cb7c672a8b0a","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"microsoft.storage","ResourceType":"microsoft.storage/storageaccounts","ResourceName":"testviram","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.storage/storageaccounts/testviram","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.storage/storageaccounts/testviram","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.storage/storageaccounts/testviram"},"displayName":"Storage account should use a private link connection","status":{"firstEvaluationDate":"2024-01-09T11:30:55.0825487Z","statusChangeDate":"2024-01-09T11:30:55.0825487Z","code":"Unhealthy"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-01-09T11:30:55.0825487Z","statusChangeDate":"2024-01-09T11:30:55.0825487Z","code":"Unhealthy"}}],"metadata":{"description":"Private links in a storage account are important for enforcing secure communication.<br> They provide private connectivity to the storage account, ensuring that data is securely transmitted and protected from potential threats.<br> If a private link connection is not used, the storage account may be exposed to risks such as data breaches or unauthorized access.<br>","severity":"Medium","displayName":"Storage account should use a private link connection","assessmentType":"BuiltIn","remediationDescription":"To enforce secure communications for your storage accounts, add a private endpoint as described here: https://aka.ms/connectprivatelytostorageaccount.","policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/6edd7eda-6dd8-40f7-810d-67160c639cd9","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"securityIssue":"NetworkPrivateNetwork","categories":["Data"],"techniques":["Network Sniffing","Network Denial of Service","Endpoint Denial of Service","Man-in-the-Middle","Data Manipulation","External Remote Services"],"tactics":["Discovery","Impact","Collection","Initial Access"],"preview":true,"remediationPolicy":"/providers/Microsoft.Authorization/policyDefinitions/9f766f00-8d11-464e-80e1-4091d7874074"},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/cdc78c07-02b0-4af0-1cb2-cb7c672a8b0a/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2fresource-graph-queries%2fproviders%2fmicrosoft.storage%2fstorageaccounts%2ftestviram"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.storage/storageaccounts/testviram","status":"Unhealthy","cause":"","assessmentKey":"cdc78c07-02b0-4af0-1cb2-cb7c672a8b0a"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln/providers/Microsoft.Security/assessments/22e93e92-4a31-b4cd-d640-3ef908430aa6","name":"22e93e92-4a31-b4cd-d640-3ef908430aa6","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"test_endpoint","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"Microsoft.Sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-vuln","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln"},"displayName":"Public network access on Azure SQL Database should be disabled","status":{"firstEvaluationDate":"2024-04-16T03:38:19.7491828Z","statusChangeDate":"2024-04-16T03:38:19.7491828Z","code":"Unhealthy"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-04-16T03:38:19.7491828Z","statusChangeDate":"2024-04-16T03:38:19.7491828Z","code":"Unhealthy"}}],"metadata":{"description":"Disabling the public network access property improves security by ensuring your Azure SQL Database can only be accessed from a private endpoint. This configuration denies all logins that match IP or virtual network based firewall rules.","severity":"Medium","displayName":"Public network access on Azure SQL Database should be disabled","assessmentType":"BuiltIn","remediationDescription":"To disable Public Network Access: 1. Open Azure SQL Database and browse to the server blade 2. Navigate to Security --> Firewalls and virtual networks blade via the navigation menu on the left. 3. Select Deny Public Network Access control and change the value to Yes.","policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/1b8ca024-1d5c-4dec-8995-b1a932b41780","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"securityIssue":"NetworkHasPublicIp","categories":["Data"],"techniques":["Exploit Public-Facing Application"],"tactics":["Initial Access"],"preview":true},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/22e93e92-4a31-b4cd-d640-3ef908430aa6/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2ftest_endpoint%2fproviders%2fMicrosoft.Sql%2fservers%2ftest-vuln"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln","status":"Unhealthy","cause":"","assessmentKey":"22e93e92-4a31-b4cd-d640-3ef908430aa6"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln/providers/Microsoft.Security/assessments/75396512-3323-9be4-059d-32ecb113c3de","name":"75396512-3323-9be4-059d-32ecb113c3de","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"test_endpoint","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"Microsoft.Sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-vuln","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln"},"displayName":"Private endpoint connections on Azure SQL Database should be enabled","status":{"firstEvaluationDate":"2024-04-16T03:38:19.749591Z","statusChangeDate":"2024-04-16T03:38:19.749591Z","code":"Unhealthy"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-04-16T03:38:19.749591Z","statusChangeDate":"2024-04-16T03:38:19.749591Z","code":"Unhealthy"}}],"metadata":{"description":"Private endpoint connections enforce secure communication by enabling private connectivity to Azure SQL Database.","severity":"Medium","displayName":"Private endpoint connections on Azure SQL Database should be enabled","assessmentType":"BuiltIn","remediationDescription":"To enable Private Endpoint Connections: 1. Open Azure SQL Database and browse to the server blade 2. Navigate to Security --> Private endpoint connections blade via the navigation menu 3.  Select the \"+ Private Endpoint\" button 4. Follow the instructions here: https://docs.microsoft.com/azure/azure-sql/database/private-endpoint-overview#how-to-set-up-private-link-for-azure-sql-database.","policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/7698e800-9299-47a6-b3b6-5a0fee576eed","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"securityIssue":"NetworkPrivateNetwork","categories":["Data"],"techniques":["Network Sniffing","Network Denial of Service","Endpoint Denial of Service","Man-in-the-Middle","Data Manipulation","External Remote Services"],"tactics":["Discovery","Impact","Collection","Initial Access"],"preview":true},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/75396512-3323-9be4-059d-32ecb113c3de/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2ftest_endpoint%2fproviders%2fMicrosoft.Sql%2fservers%2ftest-vuln"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln","status":"Unhealthy","cause":"","assessmentKey":"75396512-3323-9be4-059d-32ecb113c3de"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37","name":"82e20e14-edc5-4373-bfc4-f13121257c37","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"test_endpoint","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"microsoft.sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-vuln","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln"},"displayName":"SQL databases should have vulnerability findings resolved","additionalData":{"subAssessmentsLink":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37/subAssessments"},"status":{"firstEvaluationDate":"2024-04-15T12:39:04.7583142Z","statusChangeDate":"2024-04-15T12:39:04.7583142Z","code":"Unhealthy","cause":"Unknown"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-04-15T12:39:04.7583142Z","statusChangeDate":"2024-04-15T12:39:04.7583142Z","code":"Unhealthy","cause":"Unknown"}}],"metadata":{"description":"The SQL Vulnerability Assessment scanner identifies security vulnerabilities in databases. These vulnerabilitiess include misconfigurations, excessive permissions, and unprotected sensitive data.<br> If these vulnerabilities are not addressed, they could potentially be exploited, leading to unauthorized access or data breaches.<br>","severity":"High","displayName":"SQL databases should have vulnerability findings resolved","assessmentType":"BuiltIn","remediationDescription":"To remediate SQL vulnerabilities and mitigate risks:<br>1. Navigate to a database in the Unhealthy databases list.<br>2. Review the set of Failed security checks found by the scan, which are sorted from high to low risk.<br>3. Select a vulnerability to view its details and explicit remediation instructions and scripts<br>4. Either remediate the vulnerability using the provided script, or set the result as an acceptable baseline for the check so that it will be considered passing in subsequent scans.","policyDefinitionId":"/providers/microsoft.authorization/policydefinitions/feedbf84-6b99-488c-acc2-71c829aa5ffc","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"implementationEffort":"Moderate","securityIssue":"Vulnerability","categories":["Data"],"userImpact":"Low","techniques":["Exploit Public-Facing Application","Exploitation for Privilege Escalation","Valid Accounts","Modify Registry","Server Software Component"],"threats":["DataExfiltration","DataSpillage","AccountBreach"],"tactics":["Initial Access","Privilege Escalation","Persistence","Defense Evasion"]},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/82e20e14-edc5-4373-bfc4-f13121257c37/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2ftest_endpoint%2fproviders%2fmicrosoft.sql%2fservers%2ftest-vuln"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln","status":"Unhealthy","cause":"Unknown","assessmentKey":"82e20e14-edc5-4373-bfc4-f13121257c37"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln/providers/Microsoft.Security/assessments/94208a8b-16e8-4e5b-abbd-4e81c9d02bee","name":"94208a8b-16e8-4e5b-abbd-4e81c9d02bee","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"test_endpoint","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"Microsoft.Sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-vuln","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln"},"displayName":"Auditing on SQL server should be enabled","status":{"firstEvaluationDate":"2024-04-16T03:38:19.3764159Z","statusChangeDate":"2024-04-16T03:38:19.3764159Z","code":"Unhealthy"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-04-16T03:38:19.3764159Z","statusChangeDate":"2024-04-16T03:38:19.3764159Z","code":"Unhealthy"}}],"metadata":{"description":"Enable auditing on your SQL Server to track database activities across all databases on the server and save them in an audit log.","severity":"Low","displayName":"Auditing on SQL server should be enabled","assessmentType":"BuiltIn","remediationDescription":"To enable SQL server auditing:<br>1. Go to 'SQL servers' page in the Azure portal and select your SQL server.<br>2. From the top left menu, select 'Auditing' and choose 'Enable Azure SQL Auditing'.<br>3. Select one of the options to store the Audit logs and follow the instructions.<br>4. Select 'Save'.","policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/a6fb4358-5bf4-4ad7-ba82-2cd2f41ce5e9","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"implementationEffort":"Low","securityIssue":"Auditing","categories":["Data"],"userImpact":"Low","threats":["DataExfiltration","DataSpillage","MaliciousInsider","ThreatResistance"],"remediationPolicy":"/providers/Microsoft.Authorization/policyDefinitions/f4c68484-132f-41f9-9b6d-3e4b1cb55036"},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/94208a8b-16e8-4e5b-abbd-4e81c9d02bee/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2ftest_endpoint%2fproviders%2fMicrosoft.Sql%2fservers%2ftest-vuln"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln","status":"Unhealthy","cause":"","assessmentKey":"94208a8b-16e8-4e5b-abbd-4e81c9d02bee"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln/providers/Microsoft.Security/assessments/c076bfee-3834-4685-8ab5-17f5207c827e","name":"c076bfee-3834-4685-8ab5-17f5207c827e","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"test_endpoint","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"Microsoft.Sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-vuln","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln"},"displayName":"Azure SQL Database should have Azure Active Directory Only Authentication enabled","status":{"firstEvaluationDate":"2024-04-16T03:38:19.8714587Z","statusChangeDate":"2024-04-16T03:38:19.8714587Z","code":"Unhealthy"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-04-16T03:38:19.8714587Z","statusChangeDate":"2024-04-16T03:38:19.8714587Z","code":"Unhealthy"}}],"metadata":{"description":"Disabling local authentication methods and allowing only Azure Active Directory Authentication improves security by ensuring that Azure SQL Databases can exclusively be accessed by Azure Active Directory identities. Learn more at: aka.ms/adonlycreate.","severity":"Medium","displayName":"Azure SQL Database should have Azure Active Directory Only Authentication enabled","assessmentType":"BuiltIn","remediationDescription":"To disable local authentication methods and only allow Azure Active Directory authentication: 1. Find your Azure Sql server in the portal. 2. Navigate to Azure Active Directory in the left navigation pane. 3. Select \"Set admin\" if Azure Active Directory admin is not already set. 4. Check the \"Support only Azure Active Directory authentication for this server\" box and press \"Save\". See https://learn.microsoft.com/en-us/azure/azure-sql/database/authentication-azure-ad-only-authentication-tutorial?WT.mc_id=Portal-Microsoft_Azure_Security for further details.","policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/abda6d70-9778-44e7-84a8-06713e6db027","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"securityIssue":"PermissionsUseIdp","categories":["Data"],"techniques":["Valid Accounts","Brute Force"],"tactics":["Initial Access"],"preview":true},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/c076bfee-3834-4685-8ab5-17f5207c827e/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2ftest_endpoint%2fproviders%2fMicrosoft.Sql%2fservers%2ftest-vuln"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln","status":"Unhealthy","cause":"","assessmentKey":"c076bfee-3834-4685-8ab5-17f5207c827e"},{"id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln/providers/Microsoft.Security/assessments/f0553104-cfdb-65e6-759c-002812e38500","name":"f0553104-cfdb-65e6-759c-002812e38500","type":"microsoft.security/assessments","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","kind":"","location":"","resourceGroup":"test_endpoint","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","managedBy":"","sku":null,"plan":null,"properties":{"resourceDetails":{"ResourceProvider":"Microsoft.Sql","ResourceType":"microsoft.sql/servers","ResourceName":"test-vuln","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln","ResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln","Source":"Azure","Id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/Microsoft.Sql/servers/test-vuln"},"displayName":"SQL servers should have an Azure Active Directory administrator provisioned","status":{"firstEvaluationDate":"2024-04-16T03:38:19.3742831Z","statusChangeDate":"2024-04-16T03:38:19.3742831Z","code":"Unhealthy"},"statusPerInitiative":[{"policyInitiativeName":"ASC Default","policyInitiativeId":"1f3afdf9-d0c9-4c3d-847f-89da613e70a8","assessmentStatus":{"firstEvaluationDate":"2024-04-16T03:38:19.3742831Z","statusChangeDate":"2024-04-16T03:38:19.3742831Z","code":"Unhealthy"}}],"metadata":{"description":"Provision an Azure AD administrator for your SQL server to enable Azure AD authentication. Azure AD authentication enables simplified permission management and centralized identity management of database users and other Microsoft services.","severity":"High","displayName":"SQL servers should have an Azure Active Directory administrator provisioned","assessmentType":"BuiltIn","remediationDescription":"To provision an Azure AD administrator for SQL server, see <a target='blank' href='https://docs.microsoft.com/azure/sql-database/sql-database-aad-authentication-configure'>Configure and manage Azure Active Directory authentication with SQL Database, Managed Instance, or SQL Data Warehouse</a>","policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/1f314764-cb73-4fc9-b863-8eca98ac36e9","managementProvider":"AzurePolicy","cloudProviders":["Azure"],"implementationEffort":"Moderate","securityIssue":"PermissionsUseIdp","categories":["Data"],"userImpact":"Moderate","techniques":["Valid Accounts","Brute Force"],"threats":["MaliciousInsider","AccountBreach"],"tactics":["Initial Access"]},"links":{"azurePortal":"portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/f0553104-cfdb-65e6-759c-002812e38500/resourceId/%2fsubscriptions%2f3b496782-0e9e-4078-a59d-45a9ff2b7580%2fresourcegroups%2ftest_endpoint%2fproviders%2fMicrosoft.Sql%2fservers%2ftest-vuln"}},"tags":null,"identity":null,"zones":null,"extendedLocation":null,"source":"azure","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln","status":"Unhealthy","cause":"","assessmentKey":"f0553104-cfdb-65e6-759c-002812e38500"}],"subassessments":[{"assessmentKey":"82e20e14-edc5-4373-bfc4-f13121257c37","subassessmentKey":"2f2239b4-4c2c-6e6e-8bcc-d97141e01b73","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37/subassessments/2f2239b4-4c2c-6e6e-8bcc-d97141e01b73","properties":{"description":"The Azure SQL server-level firewall helps protect your data by preventing all access to your databases until you specify which IP addresses have permission. Server-level firewall rules grant access to all databases that belong to the server based on the originating IP address of each request.\n\nServer-level firewall rules can be created and managed through Transact-SQL as well as through the Azure portal or PowerShell. For more details please see: https://docs.microsoft.com/en-us/azure/sql-database/sql-database-firewall-configure.\n\nThis check enumerates all the server-level firewall rules so that any changes made to them can be identified and addressed.","resourceDetails":{"ResourceProvider":"microsoft.sql","ResourceType":"servers","ResourceName":"test-viram-3","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3/databases/master","source":"Azure"},"displayName":"Server-level firewall rules should be tracked and maintained at a strict minimum","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-22T23:07:27.4414285Z","benchmarks":[],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"SELECT name AS [Firewall Rule Name]\n    ,start_ip_address AS [Start Address]\n    ,end_ip_address AS [End Address]\nFROM sys.firewall_rules","scanId":"Scheduled-20240325"},"timeGenerated":"2024-04-22T23:07:28.0845934Z","remediation":"Evaluate each of the server-level firewall rules. Remove any rules that grant unnecessary access and set the rest as a baseline. Deviations from the baseline will be identified and brought to your attention in subsequent scans.","category":"SurfaceAreaReduction","id":"VA2065","status":{"severity":"High","code":"Unhealthy","cause":"Unknown"},"impact":"Firewall rules should be strictly configured to allow access only to client computers that have a valid need to connect to the database server. Any superfluous entries in the firewall may pose a threat by allowing an unauthorized source access to your databases."},"resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","description":"The Azure SQL server-level firewall helps protect your data by preventing all access to your databases until you specify which IP addresses have permission. Server-level firewall rules grant access to all databases that belong to the server based on the originating IP address of each request.\n\nServer-level firewall rules can be created and managed through Transact-SQL as well as through the Azure portal or PowerShell. For more details please see: https://docs.microsoft.com/en-us/azure/sql-database/sql-database-firewall-configure.\n\nThis check enumerates all the server-level firewall rules so that any changes made to them can be identified and addressed.","displayName":"Server-level firewall rules should be tracked and maintained at a strict minimum","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3/databases/master","resourceSource":"Azure","category":"SurfaceAreaReduction","severity":"High","code":"Unhealthy","timeGenerated":"2024-04-22T23:07:28.0845934Z","remediation":"Evaluate each of the server-level firewall rules. Remove any rules that grant unnecessary access and set the rest as a baseline. Deviations from the baseline will be identified and brought to your attention in subsequent scans.","impact":"Firewall rules should be strictly configured to allow access only to client computers that have a valid need to connect to the database server. Any superfluous entries in the firewall may pose a threat by allowing an unauthorized source access to your databases.","vulnId":"VA2065","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-22T23:07:27.4414285Z","benchmarks":[],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"SELECT name AS [Firewall Rule Name]\n    ,start_ip_address AS [Start Address]\n    ,end_ip_address AS [End Address]\nFROM sys.firewall_rules","scanId":"Scheduled-20240325"}},{"assessmentKey":"82e20e14-edc5-4373-bfc4-f13121257c37","subassessmentKey":"340c01ca-d349-174d-3e12-dd3d32864b48","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37/subassessments/340c01ca-d349-174d-3e12-dd3d32864b48","properties":{"description":"The 'dbo', or database owner, is a user account that has implied permissions to perform all activities in the database. Members of the sysadmin fixed server role are automatically mapped to dbo. This rule checks that dbo is not the only account allowed to access this database. Please note that on a newly created clean database this rule will fail until additional roles are created.","resourceDetails":{"ResourceProvider":"microsoft.sql","ResourceType":"servers","ResourceName":"test-viram-3","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3/databases/armorcode","source":"Azure"},"displayName":"'dbo' user should not be used for normal service operation","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-21T01:19:15.6539978Z","benchmarks":[{"benchmark":"FedRAMP"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"IF((SELECT count(*) from sys.database_principals  WHERE principal_id >= 5 AND principal_id < 16384 ) > 0) SELECT 0 AS [Violation]\nELSE SELECT 1 AS [Violation]","scanId":"Scheduled-20240407"},"timeGenerated":"2024-04-21T01:19:15.9038196Z","remediation":"Create users with low privileges to access the DB and any data stored in it with the appropriate set of permissions.","category":"SurfaceAreaReduction","id":"VA1143","status":{"severity":"Medium","code":"Unhealthy","cause":"Unknown"},"impact":"A compromised service that accesses the database with the 'dbo' user account will have full control of the database. To avoid this situation, lower privileged users should be defined for normal service operation, while the 'dbo' account should only be used for administrative tasks that require this privilege."},"resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","description":"The 'dbo', or database owner, is a user account that has implied permissions to perform all activities in the database. Members of the sysadmin fixed server role are automatically mapped to dbo. This rule checks that dbo is not the only account allowed to access this database. Please note that on a newly created clean database this rule will fail until additional roles are created.","displayName":"'dbo' user should not be used for normal service operation","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3/databases/armorcode","resourceSource":"Azure","category":"SurfaceAreaReduction","severity":"Medium","code":"Unhealthy","timeGenerated":"2024-04-21T01:19:15.9038196Z","remediation":"Create users with low privileges to access the DB and any data stored in it with the appropriate set of permissions.","impact":"A compromised service that accesses the database with the 'dbo' user account will have full control of the database. To avoid this situation, lower privileged users should be defined for normal service operation, while the 'dbo' account should only be used for administrative tasks that require this privilege.","vulnId":"VA1143","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-21T01:19:15.6539978Z","benchmarks":[{"benchmark":"FedRAMP"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"IF((SELECT count(*) from sys.database_principals  WHERE principal_id >= 5 AND principal_id < 16384 ) > 0) SELECT 0 AS [Violation]\nELSE SELECT 1 AS [Violation]","scanId":"Scheduled-20240407"}},{"assessmentKey":"82e20e14-edc5-4373-bfc4-f13121257c37","subassessmentKey":"42d53596-f5b2-0b4d-b0cd-c219fa006100","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37/subassessments/42d53596-f5b2-0b4d-b0cd-c219fa006100","properties":{"description":"This check tracks all users with access to a database. Make sure that these users are authorized according to their current role in the organization. ","resourceDetails":{"ResourceProvider":"microsoft.sql","ResourceType":"servers","ResourceName":"test-viram-3","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3/databases/master","source":"Azure"},"displayName":"Track all users with access to the database","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-22T23:07:27.4414285Z","benchmarks":[{"benchmark":"SOX"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"WITH UsersAndRoles (principal_name, sid, type) AS \n(\n    SELECT DISTINCT prin.name, prin.sid, prin.type \n    FROM sys.database_principals prin \n        INNER JOIN ( SELECT *\n                     FROM sys.database_permissions\n                     WHERE type = 'CO' \n                        AND state IN ('G', 'W')\n        ) perm \n            ON perm.grantee_principal_id = prin.principal_id \n        WHERE prin.type IN ('S', 'X', 'R', 'E', 'G')\n    UNION ALL\n    SELECT \n        user_name(rls.member_principal_id), prin.sid, prin.type\n    FROM \n        UsersAndRoles cte\n        INNER JOIN sys.database_role_members rls\n            ON user_name(rls.role_principal_id) = cte.principal_name\n        INNER JOIN sys.database_principals prin\n            ON rls.member_principal_id = prin.principal_id\n        WHERE cte.type = 'R'\n),\nUsers (database_user, sid) AS\n(\n    SELECT principal_name, sid\n    FROM UsersAndRoles\n    WHERE type IN ('S', 'X', 'E', 'G')\n        AND principal_name != 'dbo'\n)\nSELECT DISTINCT database_user AS [User], sid AS [SID]\n    FROM Users\n    WHERE sid != 0x01","scanId":"Scheduled-20240325"},"timeGenerated":"2024-04-22T23:07:28.0845934Z","remediation":"Revoke unnecessary access granted to users. Add the rest to the baseline. ","category":"AuthenticationAndAuthorization","id":"VA2130","status":{"severity":"Low","code":"Unhealthy","cause":"Unknown"},"impact":"Performing a User Access Review helps identify accounts that were added to the server maliciously and dormant accounts."},"resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","description":"This check tracks all users with access to a database. Make sure that these users are authorized according to their current role in the organization. ","displayName":"Track all users with access to the database","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3/databases/master","resourceSource":"Azure","category":"AuthenticationAndAuthorization","severity":"Low","code":"Unhealthy","timeGenerated":"2024-04-22T23:07:28.0845934Z","remediation":"Revoke unnecessary access granted to users. Add the rest to the baseline. ","impact":"Performing a User Access Review helps identify accounts that were added to the server maliciously and dormant accounts.","vulnId":"VA2130","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-22T23:07:27.4414285Z","benchmarks":[{"benchmark":"SOX"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"WITH UsersAndRoles (principal_name, sid, type) AS \n(\n    SELECT DISTINCT prin.name, prin.sid, prin.type \n    FROM sys.database_principals prin \n        INNER JOIN ( SELECT *\n                     FROM sys.database_permissions\n                     WHERE type = 'CO' \n                        AND state IN ('G', 'W')\n        ) perm \n            ON perm.grantee_principal_id = prin.principal_id \n        WHERE prin.type IN ('S', 'X', 'R', 'E', 'G')\n    UNION ALL\n    SELECT \n        user_name(rls.member_principal_id), prin.sid, prin.type\n    FROM \n        UsersAndRoles cte\n        INNER JOIN sys.database_role_members rls\n            ON user_name(rls.role_principal_id) = cte.principal_name\n        INNER JOIN sys.database_principals prin\n            ON rls.member_principal_id = prin.principal_id\n        WHERE cte.type = 'R'\n),\nUsers (database_user, sid) AS\n(\n    SELECT principal_name, sid\n    FROM UsersAndRoles\n    WHERE type IN ('S', 'X', 'E', 'G')\n        AND principal_name != 'dbo'\n)\nSELECT DISTINCT database_user AS [User], sid AS [SID]\n    FROM Users\n    WHERE sid != 0x01","scanId":"Scheduled-20240325"}},{"assessmentKey":"82e20e14-edc5-4373-bfc4-f13121257c37","subassessmentKey":"e26da436-4a4a-b089-8b45-c26e69d13450","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37/subassessments/e26da436-4a4a-b089-8b45-c26e69d13450","properties":{"description":"Azure SQL Database Auditing tracks database events and writes them to an audit log in your Azure storage account. Auditing helps you understand database activity and gain insight into discrepencies and anomalies that could indicate business concerns or suspected security violations, as well as helps you meet regulatory compliance.\n For more information see https://docs.microsoft.com/en-us/azure/sql-database/sql-database-auditing .\n This rule checks that auditing is enabled","resourceDetails":{"ResourceProvider":"microsoft.sql","ResourceType":"servers","ResourceName":"test-viram-3","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3/databases/master","source":"Azure"},"displayName":"Auditing should be enabled at the server level","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-22T23:07:27.4414285Z","benchmarks":[{"benchmark":"FedRAMP"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"SELECT CASE WHEN EXISTS\n    ( SELECT * FROM sys.audits WHERE name LIKE '%SqlDbAuditing%' ) THEN 0\n    ELSE 1\n    END AS [Violation]","scanId":"Scheduled-20240325"},"timeGenerated":"2024-04-22T23:07:28.0845934Z","remediation":"It is recommended to enable SQL Database Auditing at the server level so that all activities on the server itself and the databases that belong to it are tracked.","category":"AuditingAndLogging","id":"VA2061","status":{"severity":"High","code":"Unhealthy","cause":"Unknown"},"impact":"It is important to enable auditing to keep track of your database activity, as well as meet regulatory compliance requirements."},"resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","description":"Azure SQL Database Auditing tracks database events and writes them to an audit log in your Azure storage account. Auditing helps you understand database activity and gain insight into discrepencies and anomalies that could indicate business concerns or suspected security violations, as well as helps you meet regulatory compliance.\n For more information see https://docs.microsoft.com/en-us/azure/sql-database/sql-database-auditing .\n This rule checks that auditing is enabled","displayName":"Auditing should be enabled at the server level","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram-3/databases/master","resourceSource":"Azure","category":"AuditingAndLogging","severity":"High","code":"Unhealthy","timeGenerated":"2024-04-22T23:07:28.0845934Z","remediation":"It is recommended to enable SQL Database Auditing at the server level so that all activities on the server itself and the databases that belong to it are tracked.","impact":"It is important to enable auditing to keep track of your database activity, as well as meet regulatory compliance requirements.","vulnId":"VA2061","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-22T23:07:27.4414285Z","benchmarks":[{"benchmark":"FedRAMP"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"SELECT CASE WHEN EXISTS\n    ( SELECT * FROM sys.audits WHERE name LIKE '%SqlDbAuditing%' ) THEN 0\n    ELSE 1\n    END AS [Violation]","scanId":"Scheduled-20240325"}},{"assessmentKey":"82e20e14-edc5-4373-bfc4-f13121257c37","subassessmentKey":"412e2332-f81d-4b16-edb4-22ded77535c5","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37/subassessments/412e2332-f81d-4b16-edb4-22ded77535c5","properties":{"description":"The 'dbo', or database owner, is a user account that has implied permissions to perform all activities in the database. Members of the sysadmin fixed server role are automatically mapped to dbo. This rule checks that dbo is not the only account allowed to access this database. Please note that on a newly created clean database this rule will fail until additional roles are created.","resourceDetails":{"ResourceProvider":"microsoft.sql","ResourceType":"servers","ResourceName":"test-viram","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/databases/finding","source":"Azure"},"displayName":"'dbo' user should not be used for normal service operation","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-17T20:22:48.8195164Z","benchmarks":[{"benchmark":"FedRAMP"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"IF((SELECT count(*) from sys.database_principals  WHERE principal_id >= 5 AND principal_id < 16384 ) > 0) SELECT 0 AS [Violation]\nELSE SELECT 1 AS [Violation]","scanId":"Scheduled-20240327"},"timeGenerated":"2024-04-17T20:22:49.1546309Z","remediation":"Create users with low privileges to access the DB and any data stored in it with the appropriate set of permissions.","category":"SurfaceAreaReduction","id":"VA1143","status":{"severity":"Medium","code":"Unhealthy","cause":"Unknown"},"impact":"A compromised service that accesses the database with the 'dbo' user account will have full control of the database. To avoid this situation, lower privileged users should be defined for normal service operation, while the 'dbo' account should only be used for administrative tasks that require this privilege."},"resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","description":"The 'dbo', or database owner, is a user account that has implied permissions to perform all activities in the database. Members of the sysadmin fixed server role are automatically mapped to dbo. This rule checks that dbo is not the only account allowed to access this database. Please note that on a newly created clean database this rule will fail until additional roles are created.","displayName":"'dbo' user should not be used for normal service operation","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/databases/finding","resourceSource":"Azure","category":"SurfaceAreaReduction","severity":"Medium","code":"Unhealthy","timeGenerated":"2024-04-17T20:22:49.1546309Z","remediation":"Create users with low privileges to access the DB and any data stored in it with the appropriate set of permissions.","impact":"A compromised service that accesses the database with the 'dbo' user account will have full control of the database. To avoid this situation, lower privileged users should be defined for normal service operation, while the 'dbo' account should only be used for administrative tasks that require this privilege.","vulnId":"VA1143","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-17T20:22:48.8195164Z","benchmarks":[{"benchmark":"FedRAMP"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"IF((SELECT count(*) from sys.database_principals  WHERE principal_id >= 5 AND principal_id < 16384 ) > 0) SELECT 0 AS [Violation]\nELSE SELECT 1 AS [Violation]","scanId":"Scheduled-20240327"}},{"assessmentKey":"82e20e14-edc5-4373-bfc4-f13121257c37","subassessmentKey":"60e66795-44a2-d426-8eaa-2f360084a174","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37/subassessments/60e66795-44a2-d426-8eaa-2f360084a174","properties":{"description":"This check tracks all users with access to a database. Make sure that these users are authorized according to their current role in the organization. ","resourceDetails":{"ResourceProvider":"microsoft.sql","ResourceType":"servers","ResourceName":"test-viram","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/databases/master","source":"Azure"},"displayName":"Track all users with access to the database","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-20T23:06:38.4262486Z","benchmarks":[{"benchmark":"SOX"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"WITH UsersAndRoles (principal_name, sid, type) AS \n(\n    SELECT DISTINCT prin.name, prin.sid, prin.type \n    FROM sys.database_principals prin \n        INNER JOIN ( SELECT *\n                     FROM sys.database_permissions\n                     WHERE type = 'CO' \n                        AND state IN ('G', 'W')\n        ) perm \n            ON perm.grantee_principal_id = prin.principal_id \n        WHERE prin.type IN ('S', 'X', 'R', 'E', 'G')\n    UNION ALL\n    SELECT \n        user_name(rls.member_principal_id), prin.sid, prin.type\n    FROM \n        UsersAndRoles cte\n        INNER JOIN sys.database_role_members rls\n            ON user_name(rls.role_principal_id) = cte.principal_name\n        INNER JOIN sys.database_principals prin\n            ON rls.member_principal_id = prin.principal_id\n        WHERE cte.type = 'R'\n),\nUsers (database_user, sid) AS\n(\n    SELECT principal_name, sid\n    FROM UsersAndRoles\n    WHERE type IN ('S', 'X', 'E', 'G')\n        AND principal_name != 'dbo'\n)\nSELECT DISTINCT database_user AS [User], sid AS [SID]\n    FROM Users\n    WHERE sid != 0x01","scanId":"Scheduled-20240406"},"timeGenerated":"2024-04-20T23:06:38.961369Z","remediation":"Revoke unnecessary access granted to users. Add the rest to the baseline. ","category":"AuthenticationAndAuthorization","id":"VA2130","status":{"severity":"Low","code":"Unhealthy","cause":"Unknown"},"impact":"Performing a User Access Review helps identify accounts that were added to the server maliciously and dormant accounts."},"resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","description":"This check tracks all users with access to a database. Make sure that these users are authorized according to their current role in the organization. ","displayName":"Track all users with access to the database","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/databases/master","resourceSource":"Azure","category":"AuthenticationAndAuthorization","severity":"Low","code":"Unhealthy","timeGenerated":"2024-04-20T23:06:38.961369Z","remediation":"Revoke unnecessary access granted to users. Add the rest to the baseline. ","impact":"Performing a User Access Review helps identify accounts that were added to the server maliciously and dormant accounts.","vulnId":"VA2130","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-20T23:06:38.4262486Z","benchmarks":[{"benchmark":"SOX"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"WITH UsersAndRoles (principal_name, sid, type) AS \n(\n    SELECT DISTINCT prin.name, prin.sid, prin.type \n    FROM sys.database_principals prin \n        INNER JOIN ( SELECT *\n                     FROM sys.database_permissions\n                     WHERE type = 'CO' \n                        AND state IN ('G', 'W')\n        ) perm \n            ON perm.grantee_principal_id = prin.principal_id \n        WHERE prin.type IN ('S', 'X', 'R', 'E', 'G')\n    UNION ALL\n    SELECT \n        user_name(rls.member_principal_id), prin.sid, prin.type\n    FROM \n        UsersAndRoles cte\n        INNER JOIN sys.database_role_members rls\n            ON user_name(rls.role_principal_id) = cte.principal_name\n        INNER JOIN sys.database_principals prin\n            ON rls.member_principal_id = prin.principal_id\n        WHERE cte.type = 'R'\n),\nUsers (database_user, sid) AS\n(\n    SELECT principal_name, sid\n    FROM UsersAndRoles\n    WHERE type IN ('S', 'X', 'E', 'G')\n        AND principal_name != 'dbo'\n)\nSELECT DISTINCT database_user AS [User], sid AS [SID]\n    FROM Users\n    WHERE sid != 0x01","scanId":"Scheduled-20240406"}},{"assessmentKey":"82e20e14-edc5-4373-bfc4-f13121257c37","subassessmentKey":"8845640e-3573-5a69-e55d-621c90035951","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37/subassessments/8845640e-3573-5a69-e55d-621c90035951","properties":{"description":"Azure SQL Database Auditing tracks database events and writes them to an audit log in your Azure storage account. Auditing helps you understand database activity and gain insight into discrepencies and anomalies that could indicate business concerns or suspected security violations, as well as helps you meet regulatory compliance.\n For more information see https://docs.microsoft.com/en-us/azure/sql-database/sql-database-auditing .\n This rule checks that auditing is enabled","resourceDetails":{"ResourceProvider":"microsoft.sql","ResourceType":"servers","ResourceName":"test-viram","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/databases/master","source":"Azure"},"displayName":"Auditing should be enabled at the server level","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-20T23:06:38.4262486Z","benchmarks":[{"benchmark":"FedRAMP"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"SELECT CASE WHEN EXISTS\n    ( SELECT * FROM sys.audits WHERE name LIKE '%SqlDbAuditing%' ) THEN 0\n    ELSE 1\n    END AS [Violation]","scanId":"Scheduled-20240406"},"timeGenerated":"2024-04-20T23:06:38.961369Z","remediation":"It is recommended to enable SQL Database Auditing at the server level so that all activities on the server itself and the databases that belong to it are tracked.","category":"AuditingAndLogging","id":"VA2061","status":{"severity":"High","code":"Unhealthy","cause":"Unknown"},"impact":"It is important to enable auditing to keep track of your database activity, as well as meet regulatory compliance requirements."},"resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","description":"Azure SQL Database Auditing tracks database events and writes them to an audit log in your Azure storage account. Auditing helps you understand database activity and gain insight into discrepencies and anomalies that could indicate business concerns or suspected security violations, as well as helps you meet regulatory compliance.\n For more information see https://docs.microsoft.com/en-us/azure/sql-database/sql-database-auditing .\n This rule checks that auditing is enabled","displayName":"Auditing should be enabled at the server level","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/databases/master","resourceSource":"Azure","category":"AuditingAndLogging","severity":"High","code":"Unhealthy","timeGenerated":"2024-04-20T23:06:38.961369Z","remediation":"It is recommended to enable SQL Database Auditing at the server level so that all activities on the server itself and the databases that belong to it are tracked.","impact":"It is important to enable auditing to keep track of your database activity, as well as meet regulatory compliance requirements.","vulnId":"VA2061","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-20T23:06:38.4262486Z","benchmarks":[{"benchmark":"FedRAMP"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"SELECT CASE WHEN EXISTS\n    ( SELECT * FROM sys.audits WHERE name LIKE '%SqlDbAuditing%' ) THEN 0\n    ELSE 1\n    END AS [Violation]","scanId":"Scheduled-20240406"}},{"assessmentKey":"82e20e14-edc5-4373-bfc4-f13121257c37","subassessmentKey":"baf723d0-f398-c28e-52fc-d77c21b7099b","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37/subassessments/baf723d0-f398-c28e-52fc-d77c21b7099b","properties":{"description":"The Azure SQL server-level firewall helps protect your data by preventing all access to your databases until you specify which IP addresses have permission. Server-level firewall rules grant access to all databases that belong to the server based on the originating IP address of each request.\n\nServer-level firewall rules can be created and managed through Transact-SQL as well as through the Azure portal or PowerShell. For more details please see: https://docs.microsoft.com/en-us/azure/sql-database/sql-database-firewall-configure.\n\nThis check enumerates all the server-level firewall rules so that any changes made to them can be identified and addressed.","resourceDetails":{"ResourceProvider":"microsoft.sql","ResourceType":"servers","ResourceName":"test-viram","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/databases/master","source":"Azure"},"displayName":"Server-level firewall rules should be tracked and maintained at a strict minimum","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-20T23:06:38.4262486Z","benchmarks":[],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"SELECT name AS [Firewall Rule Name]\n    ,start_ip_address AS [Start Address]\n    ,end_ip_address AS [End Address]\nFROM sys.firewall_rules","scanId":"Scheduled-20240406"},"timeGenerated":"2024-04-20T23:06:38.961369Z","remediation":"Evaluate each of the server-level firewall rules. Remove any rules that grant unnecessary access and set the rest as a baseline. Deviations from the baseline will be identified and brought to your attention in subsequent scans.","category":"SurfaceAreaReduction","id":"VA2065","status":{"severity":"High","code":"Unhealthy","cause":"Unknown"},"impact":"Firewall rules should be strictly configured to allow access only to client computers that have a valid need to connect to the database server. Any superfluous entries in the firewall may pose a threat by allowing an unauthorized source access to your databases."},"resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","description":"The Azure SQL server-level firewall helps protect your data by preventing all access to your databases until you specify which IP addresses have permission. Server-level firewall rules grant access to all databases that belong to the server based on the originating IP address of each request.\n\nServer-level firewall rules can be created and managed through Transact-SQL as well as through the Azure portal or PowerShell. For more details please see: https://docs.microsoft.com/en-us/azure/sql-database/sql-database-firewall-configure.\n\nThis check enumerates all the server-level firewall rules so that any changes made to them can be identified and addressed.","displayName":"Server-level firewall rules should be tracked and maintained at a strict minimum","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/databases/master","resourceSource":"Azure","category":"SurfaceAreaReduction","severity":"High","code":"Unhealthy","timeGenerated":"2024-04-20T23:06:38.961369Z","remediation":"Evaluate each of the server-level firewall rules. Remove any rules that grant unnecessary access and set the rest as a baseline. Deviations from the baseline will be identified and brought to your attention in subsequent scans.","impact":"Firewall rules should be strictly configured to allow access only to client computers that have a valid need to connect to the database server. Any superfluous entries in the firewall may pose a threat by allowing an unauthorized source access to your databases.","vulnId":"VA2065","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-20T23:06:38.4262486Z","benchmarks":[],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"SELECT name AS [Firewall Rule Name]\n    ,start_ip_address AS [Start Address]\n    ,end_ip_address AS [End Address]\nFROM sys.firewall_rules","scanId":"Scheduled-20240406"}},{"assessmentKey":"82e20e14-edc5-4373-bfc4-f13121257c37","subassessmentKey":"c02515c3-3d80-651e-12b2-ba0b3b58afd6","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37/subassessments/c02515c3-3d80-651e-12b2-ba0b3b58afd6","properties":{"description":"The 'dbo', or database owner, is a user account that has implied permissions to perform all activities in the database. Members of the sysadmin fixed server role are automatically mapped to dbo. This rule checks that dbo is not the only account allowed to access this database. Please note that on a newly created clean database this rule will fail until additional roles are created.","resourceDetails":{"ResourceProvider":"microsoft.sql","ResourceType":"servers","ResourceName":"test-viram","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/databases/test-findings","source":"Azure"},"displayName":"'dbo' user should not be used for normal service operation","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-22T06:20:35.2137875Z","benchmarks":[{"benchmark":"FedRAMP"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"IF((SELECT count(*) from sys.database_principals  WHERE principal_id >= 5 AND principal_id < 16384 ) > 0) SELECT 0 AS [Violation]\nELSE SELECT 1 AS [Violation]","scanId":"Scheduled-20240401"},"timeGenerated":"2024-04-22T06:20:36.163784Z","remediation":"Create users with low privileges to access the DB and any data stored in it with the appropriate set of permissions.","category":"SurfaceAreaReduction","id":"VA1143","status":{"severity":"Medium","code":"Unhealthy","cause":"Unknown"},"impact":"A compromised service that accesses the database with the 'dbo' user account will have full control of the database. To avoid this situation, lower privileged users should be defined for normal service operation, while the 'dbo' account should only be used for administrative tasks that require this privilege."},"resourceGroup":"resource-graph-queries","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","description":"The 'dbo', or database owner, is a user account that has implied permissions to perform all activities in the database. Members of the sysadmin fixed server role are automatically mapped to dbo. This rule checks that dbo is not the only account allowed to access this database. Please note that on a newly created clean database this rule will fail until additional roles are created.","displayName":"'dbo' user should not be used for normal service operation","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/resource-graph-queries/providers/microsoft.sql/servers/test-viram/databases/test-findings","resourceSource":"Azure","category":"SurfaceAreaReduction","severity":"Medium","code":"Unhealthy","timeGenerated":"2024-04-22T06:20:36.163784Z","remediation":"Create users with low privileges to access the DB and any data stored in it with the appropriate set of permissions.","impact":"A compromised service that accesses the database with the 'dbo' user account will have full control of the database. To avoid this situation, lower privileged users should be defined for normal service operation, while the 'dbo' account should only be used for administrative tasks that require this privilege.","vulnId":"VA1143","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-22T06:20:35.2137875Z","benchmarks":[{"benchmark":"FedRAMP"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"IF((SELECT count(*) from sys.database_principals  WHERE principal_id >= 5 AND principal_id < 16384 ) > 0) SELECT 0 AS [Violation]\nELSE SELECT 1 AS [Violation]","scanId":"Scheduled-20240401"}},{"assessmentKey":"82e20e14-edc5-4373-bfc4-f13121257c37","subassessmentKey":"359df2c1-f034-1fd6-d8a3-42118af66fe8","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37/subassessments/359df2c1-f034-1fd6-d8a3-42118af66fe8","properties":{"description":"Azure SQL Database Auditing tracks database events and writes them to an audit log in your Azure storage account. Auditing helps you understand database activity and gain insight into discrepencies and anomalies that could indicate business concerns or suspected security violations, as well as helps you meet regulatory compliance.\n For more information see https://docs.microsoft.com/en-us/azure/sql-database/sql-database-auditing .\n This rule checks that auditing is enabled","resourceDetails":{"ResourceProvider":"microsoft.sql","ResourceType":"servers","ResourceName":"test-vuln","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln/databases/master","source":"Azure"},"displayName":"Auditing should be enabled at the server level","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-21T00:05:54.5100574Z","benchmarks":[{"benchmark":"FedRAMP"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"SELECT CASE WHEN EXISTS\n    ( SELECT * FROM sys.audits WHERE name LIKE '%SqlDbAuditing%' ) THEN 0\n    ELSE 1\n    END AS [Violation]","scanId":"Scheduled-20240421"},"timeGenerated":"2024-04-21T00:06:06.0288999Z","remediation":"It is recommended to enable SQL Database Auditing at the server level so that all activities on the server itself and the databases that belong to it are tracked.","category":"AuditingAndLogging","id":"VA2061","status":{"severity":"High","code":"Unhealthy","cause":"Unknown"},"impact":"It is important to enable auditing to keep track of your database activity, as well as meet regulatory compliance requirements."},"resourceGroup":"test_endpoint","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","description":"Azure SQL Database Auditing tracks database events and writes them to an audit log in your Azure storage account. Auditing helps you understand database activity and gain insight into discrepencies and anomalies that could indicate business concerns or suspected security violations, as well as helps you meet regulatory compliance.\n For more information see https://docs.microsoft.com/en-us/azure/sql-database/sql-database-auditing .\n This rule checks that auditing is enabled","displayName":"Auditing should be enabled at the server level","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln/databases/master","resourceSource":"Azure","category":"AuditingAndLogging","severity":"High","code":"Unhealthy","timeGenerated":"2024-04-21T00:06:06.0288999Z","remediation":"It is recommended to enable SQL Database Auditing at the server level so that all activities on the server itself and the databases that belong to it are tracked.","impact":"It is important to enable auditing to keep track of your database activity, as well as meet regulatory compliance requirements.","vulnId":"VA2061","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-21T00:05:54.5100574Z","benchmarks":[{"benchmark":"FedRAMP"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"SELECT CASE WHEN EXISTS\n    ( SELECT * FROM sys.audits WHERE name LIKE '%SqlDbAuditing%' ) THEN 0\n    ELSE 1\n    END AS [Violation]","scanId":"Scheduled-20240421"}},{"assessmentKey":"82e20e14-edc5-4373-bfc4-f13121257c37","subassessmentKey":"7a35f9f3-71be-b52b-5903-5a8b2c3edaeb","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37/subassessments/7a35f9f3-71be-b52b-5903-5a8b2c3edaeb","properties":{"description":"This check tracks all users with access to a database. Make sure that these users are authorized according to their current role in the organization. ","resourceDetails":{"ResourceProvider":"microsoft.sql","ResourceType":"servers","ResourceName":"test-vuln","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln/databases/master","source":"Azure"},"displayName":"Track all users with access to the database","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-21T00:05:54.5100574Z","benchmarks":[{"benchmark":"SOX"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"WITH UsersAndRoles (principal_name, sid, type) AS \n(\n    SELECT DISTINCT prin.name, prin.sid, prin.type \n    FROM sys.database_principals prin \n        INNER JOIN ( SELECT *\n                     FROM sys.database_permissions\n                     WHERE type = 'CO' \n                        AND state IN ('G', 'W')\n        ) perm \n            ON perm.grantee_principal_id = prin.principal_id \n        WHERE prin.type IN ('S', 'X', 'R', 'E', 'G')\n    UNION ALL\n    SELECT \n        user_name(rls.member_principal_id), prin.sid, prin.type\n    FROM \n        UsersAndRoles cte\n        INNER JOIN sys.database_role_members rls\n            ON user_name(rls.role_principal_id) = cte.principal_name\n        INNER JOIN sys.database_principals prin\n            ON rls.member_principal_id = prin.principal_id\n        WHERE cte.type = 'R'\n),\nUsers (database_user, sid) AS\n(\n    SELECT principal_name, sid\n    FROM UsersAndRoles\n    WHERE type IN ('S', 'X', 'E', 'G')\n        AND principal_name != 'dbo'\n)\nSELECT DISTINCT database_user AS [User], sid AS [SID]\n    FROM Users\n    WHERE sid != 0x01","scanId":"Scheduled-20240421"},"timeGenerated":"2024-04-21T00:06:06.0288999Z","remediation":"Revoke unnecessary access granted to users. Add the rest to the baseline. ","category":"AuthenticationAndAuthorization","id":"VA2130","status":{"severity":"Low","code":"Unhealthy","cause":"Unknown"},"impact":"Performing a User Access Review helps identify accounts that were added to the server maliciously and dormant accounts."},"resourceGroup":"test_endpoint","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","description":"This check tracks all users with access to a database. Make sure that these users are authorized according to their current role in the organization. ","displayName":"Track all users with access to the database","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln/databases/master","resourceSource":"Azure","category":"AuthenticationAndAuthorization","severity":"Low","code":"Unhealthy","timeGenerated":"2024-04-21T00:06:06.0288999Z","remediation":"Revoke unnecessary access granted to users. Add the rest to the baseline. ","impact":"Performing a User Access Review helps identify accounts that were added to the server maliciously and dormant accounts.","vulnId":"VA2130","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-21T00:05:54.5100574Z","benchmarks":[{"benchmark":"SOX"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"WITH UsersAndRoles (principal_name, sid, type) AS \n(\n    SELECT DISTINCT prin.name, prin.sid, prin.type \n    FROM sys.database_principals prin \n        INNER JOIN ( SELECT *\n                     FROM sys.database_permissions\n                     WHERE type = 'CO' \n                        AND state IN ('G', 'W')\n        ) perm \n            ON perm.grantee_principal_id = prin.principal_id \n        WHERE prin.type IN ('S', 'X', 'R', 'E', 'G')\n    UNION ALL\n    SELECT \n        user_name(rls.member_principal_id), prin.sid, prin.type\n    FROM \n        UsersAndRoles cte\n        INNER JOIN sys.database_role_members rls\n            ON user_name(rls.role_principal_id) = cte.principal_name\n        INNER JOIN sys.database_principals prin\n            ON rls.member_principal_id = prin.principal_id\n        WHERE cte.type = 'R'\n),\nUsers (database_user, sid) AS\n(\n    SELECT principal_name, sid\n    FROM UsersAndRoles\n    WHERE type IN ('S', 'X', 'E', 'G')\n        AND principal_name != 'dbo'\n)\nSELECT DISTINCT database_user AS [User], sid AS [SID]\n    FROM Users\n    WHERE sid != 0x01","scanId":"Scheduled-20240421"}},{"assessmentKey":"82e20e14-edc5-4373-bfc4-f13121257c37","subassessmentKey":"8a96f6d3-a603-7bc3-d4b1-1f23510dd395","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37/subassessments/8a96f6d3-a603-7bc3-d4b1-1f23510dd395","properties":{"description":"The Azure SQL server-level firewall helps protect your data by preventing all access to your databases until you specify which IP addresses have permission. Server-level firewall rules grant access to all databases that belong to the server based on the originating IP address of each request.\n\nServer-level firewall rules can be created and managed through Transact-SQL as well as through the Azure portal or PowerShell. For more details please see: https://docs.microsoft.com/en-us/azure/sql-database/sql-database-firewall-configure.\n\nThis check enumerates all the server-level firewall rules so that any changes made to them can be identified and addressed.","resourceDetails":{"ResourceProvider":"microsoft.sql","ResourceType":"servers","ResourceName":"test-vuln","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln/databases/master","source":"Azure"},"displayName":"Server-level firewall rules should be tracked and maintained at a strict minimum","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-21T00:05:54.5100574Z","benchmarks":[],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"SELECT name AS [Firewall Rule Name]\n    ,start_ip_address AS [Start Address]\n    ,end_ip_address AS [End Address]\nFROM sys.firewall_rules","scanId":"Scheduled-20240421"},"timeGenerated":"2024-04-21T00:06:06.0288999Z","remediation":"Evaluate each of the server-level firewall rules. Remove any rules that grant unnecessary access and set the rest as a baseline. Deviations from the baseline will be identified and brought to your attention in subsequent scans.","category":"SurfaceAreaReduction","id":"VA2065","status":{"severity":"High","code":"Unhealthy","cause":"Unknown"},"impact":"Firewall rules should be strictly configured to allow access only to client computers that have a valid need to connect to the database server. Any superfluous entries in the firewall may pose a threat by allowing an unauthorized source access to your databases."},"resourceGroup":"test_endpoint","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","description":"The Azure SQL server-level firewall helps protect your data by preventing all access to your databases until you specify which IP addresses have permission. Server-level firewall rules grant access to all databases that belong to the server based on the originating IP address of each request.\n\nServer-level firewall rules can be created and managed through Transact-SQL as well as through the Azure portal or PowerShell. For more details please see: https://docs.microsoft.com/en-us/azure/sql-database/sql-database-firewall-configure.\n\nThis check enumerates all the server-level firewall rules so that any changes made to them can be identified and addressed.","displayName":"Server-level firewall rules should be tracked and maintained at a strict minimum","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln/databases/master","resourceSource":"Azure","category":"SurfaceAreaReduction","severity":"High","code":"Unhealthy","timeGenerated":"2024-04-21T00:06:06.0288999Z","remediation":"Evaluate each of the server-level firewall rules. Remove any rules that grant unnecessary access and set the rest as a baseline. Deviations from the baseline will be identified and brought to your attention in subsequent scans.","impact":"Firewall rules should be strictly configured to allow access only to client computers that have a valid need to connect to the database server. Any superfluous entries in the firewall may pose a threat by allowing an unauthorized source access to your databases.","vulnId":"VA2065","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-21T00:05:54.5100574Z","benchmarks":[],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"SELECT name AS [Firewall Rule Name]\n    ,start_ip_address AS [Start Address]\n    ,end_ip_address AS [End Address]\nFROM sys.firewall_rules","scanId":"Scheduled-20240421"}},{"assessmentKey":"82e20e14-edc5-4373-bfc4-f13121257c37","subassessmentKey":"d63eb309-65d4-19f4-dfdd-1757b2228c07","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln/providers/Microsoft.Security/assessments/82e20e14-edc5-4373-bfc4-f13121257c37/subassessments/d63eb309-65d4-19f4-dfdd-1757b2228c07","properties":{"description":"The 'dbo', or database owner, is a user account that has implied permissions to perform all activities in the database. Members of the sysadmin fixed server role are automatically mapped to dbo. This rule checks that dbo is not the only account allowed to access this database. Please note that on a newly created clean database this rule will fail until additional roles are created.","resourceDetails":{"ResourceProvider":"microsoft.sql","ResourceType":"servers","ResourceName":"test-vuln","NativeResourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln","id":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln/databases/testttt","source":"Azure"},"displayName":"'dbo' user should not be used for normal service operation","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-22T03:24:58.3290536Z","benchmarks":[{"benchmark":"FedRAMP"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"IF((SELECT count(*) from sys.database_principals  WHERE principal_id >= 5 AND principal_id < 16384 ) > 0) SELECT 0 AS [Violation]\nELSE SELECT 1 AS [Violation]","scanId":"7420286d-5700-4b45-9828-ef9197016ba1"},"timeGenerated":"2024-04-22T03:24:58.5929707Z","remediation":"Create users with low privileges to access the DB and any data stored in it with the appropriate set of permissions.","category":"SurfaceAreaReduction","id":"VA1143","status":{"severity":"Medium","code":"Unhealthy","cause":"Unknown"},"impact":"A compromised service that accesses the database with the 'dbo' user account will have full control of the database. To avoid this situation, lower privileged users should be defined for normal service operation, while the 'dbo' account should only be used for administrative tasks that require this privilege."},"resourceGroup":"test_endpoint","subscriptionId":"3b496782-0e9e-4078-a59d-45a9ff2b7580","tenantId":"bd6e23d7-2e5b-4403-942a-b32d7fa015f8","description":"The 'dbo', or database owner, is a user account that has implied permissions to perform all activities in the database. Members of the sysadmin fixed server role are automatically mapped to dbo. This rule checks that dbo is not the only account allowed to access this database. Please note that on a newly created clean database this rule will fail until additional roles are created.","displayName":"'dbo' user should not be used for normal service operation","resourceId":"/subscriptions/3b496782-0e9e-4078-a59d-45a9ff2b7580/resourcegroups/test_endpoint/providers/microsoft.sql/servers/test-vuln/databases/testttt","resourceSource":"Azure","category":"SurfaceAreaReduction","severity":"Medium","code":"Unhealthy","timeGenerated":"2024-04-22T03:24:58.5929707Z","remediation":"Create users with low privileges to access the DB and any data stored in it with the appropriate set of permissions.","impact":"A compromised service that accesses the database with the 'dbo' user account will have full control of the database. To avoid this situation, lower privileged users should be defined for normal service operation, while the 'dbo' account should only be used for administrative tasks that require this privilege.","vulnId":"VA1143","additionalData":{"assessedResourceType":"SqlVirtualMachineVulnerability","lastReportedScanTime":"2024-04-22T03:24:58.3290536Z","benchmarks":[{"benchmark":"FedRAMP"}],"workspaceSubscriptionId":"00000000-0000-0000-0000-000000000000","query":"IF((SELECT count(*) from sys.database_principals  WHERE principal_id >= 5 AND principal_id < 16384 ) > 0) SELECT 0 AS [Violation]\nELSE SELECT 1 AS [Violation]","scanId":"7420286d-5700-4b45-9828-ef9197016ba1"}}],"securityAlerts":[]}